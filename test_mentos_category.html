<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mentos Category</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { display: flex; gap: 20px; }
        .column { flex: 1; border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
        .product { border: 1px solid #eee; padding: 10px; margin: 5px 0; border-radius: 3px; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
        .match { background: #d4edda; border-color: #c3e6cb; }
        .mismatch { background: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 15px; margin: 5px; background: #007AFF; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Test Mentos Category Consistency</h1>
    
    <button onclick="testMentosCategory()">Test Mentos Category</button>
    <button onclick="testAllProducts()">Test All Products</button>
    
    <div id="status"></div>
    
    <div class="container">
        <div class="column">
            <h2>Admin Dashboard</h2>
            <div id="admin-mentos">Loading...</div>
        </div>
        <div class="column">
            <h2>Ecommerce</h2>
            <div id="ecommerce-mentos">Loading...</div>
        </div>
    </div>
    
    <div style="margin-top: 20px;">
        <h2>All Products Comparison</h2>
        <div id="all-products"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8191/api';
        
        async function testMentosCategory() {
            document.getElementById('status').innerHTML = '<p>Testing Mentos category...</p>';
            
            let adminMentos = null;
            let ecommerceMentos = null;
            
            // Test Admin API
            try {
                const adminResponse = await fetch(`${API_BASE}/admin/products`);
                const adminData = await adminResponse.json();
                
                if (adminData.status && adminData.data && adminData.data.products) {
                    adminMentos = adminData.data.products.find(p => 
                        p.name.toLowerCase().includes('mentos')
                    );
                    
                    if (adminMentos) {
                        document.getElementById('admin-mentos').innerHTML = `
                            <div class="product">
                                <h3>${adminMentos.name}</h3>
                                <p><strong>ID:</strong> ${adminMentos.id}</p>
                                <p><strong>Category ID:</strong> ${adminMentos.categoryId}</p>
                                <p><strong>Category:</strong> <span class="success">${adminMentos.category}</span></p>
                                <p><strong>Price:</strong> Rp ${adminMentos.price.toLocaleString()}</p>
                            </div>
                        `;
                    } else {
                        document.getElementById('admin-mentos').innerHTML = '<p class="error">Mentos not found in Admin API</p>';
                    }
                } else {
                    document.getElementById('admin-mentos').innerHTML = '<p class="error">Admin API failed</p>';
                }
            } catch (error) {
                document.getElementById('admin-mentos').innerHTML = `<p class="error">Admin API Error: ${error.message}</p>`;
            }
            
            // Test Ecommerce API
            try {
                const ecommerceResponse = await fetch(`${API_BASE}/products`);
                const ecommerceData = await ecommerceResponse.json();
                
                if (ecommerceData.status && ecommerceData.data && ecommerceData.data.products) {
                    ecommerceMentos = ecommerceData.data.products.find(p => 
                        p.name.toLowerCase().includes('mentos')
                    );
                    
                    if (ecommerceMentos) {
                        const categoryClass = ecommerceMentos.category === 'Unknown' ? 'error' : 'success';
                        document.getElementById('ecommerce-mentos').innerHTML = `
                            <div class="product">
                                <h3>${ecommerceMentos.name}</h3>
                                <p><strong>ID:</strong> ${ecommerceMentos.id}</p>
                                <p><strong>Category ID:</strong> ${ecommerceMentos.categoryId}</p>
                                <p><strong>Category:</strong> <span class="${categoryClass}">${ecommerceMentos.category}</span></p>
                                <p><strong>Price:</strong> Rp ${ecommerceMentos.price.toLocaleString()}</p>
                            </div>
                        `;
                    } else {
                        document.getElementById('ecommerce-mentos').innerHTML = '<p class="error">Mentos not found in Ecommerce API</p>';
                    }
                } else {
                    document.getElementById('ecommerce-mentos').innerHTML = '<p class="error">Ecommerce API failed</p>';
                }
            } catch (error) {
                document.getElementById('ecommerce-mentos').innerHTML = `<p class="error">Ecommerce API Error: ${error.message}</p>`;
            }
            
            // Compare results
            if (adminMentos && ecommerceMentos) {
                const categoriesMatch = adminMentos.category === ecommerceMentos.category;
                const statusClass = categoriesMatch ? 'success' : 'error';
                const statusText = categoriesMatch ? 'CATEGORIES MATCH ✅' : 'CATEGORIES MISMATCH ❌';
                
                document.getElementById('status').innerHTML = `
                    <div class="product ${categoriesMatch ? 'match' : 'mismatch'}">
                        <h3 class="${statusClass}">${statusText}</h3>
                        <p><strong>Admin Category:</strong> ${adminMentos.category}</p>
                        <p><strong>Ecommerce Category:</strong> ${ecommerceMentos.category}</p>
                    </div>
                `;
            }
        }
        
        async function testAllProducts() {
            const result = document.getElementById('all-products');
            result.innerHTML = '<p>Loading all products comparison...</p>';
            
            try {
                const [adminResponse, ecommerceResponse] = await Promise.all([
                    fetch(`${API_BASE}/admin/products`),
                    fetch(`${API_BASE}/products`)
                ]);
                
                const adminData = await adminResponse.json();
                const ecommerceData = await ecommerceResponse.json();
                
                if (adminData.status && ecommerceData.status) {
                    const adminProducts = adminData.data.products;
                    const ecommerceProducts = ecommerceData.data.products;
                    
                    let html = `
                        <h3>Products Comparison</h3>
                        <p><strong>Admin Products:</strong> ${adminProducts.length}</p>
                        <p><strong>Ecommerce Products:</strong> ${ecommerceProducts.length}</p>
                        <table border="1" style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <th>Product Name</th>
                                <th>Admin Category</th>
                                <th>Ecommerce Category</th>
                                <th>Status</th>
                            </tr>
                    `;
                    
                    adminProducts.forEach(adminProduct => {
                        const ecommerceProduct = ecommerceProducts.find(p => p.id === adminProduct.id);
                        if (ecommerceProduct) {
                            const match = adminProduct.category === ecommerceProduct.category;
                            html += `
                                <tr style="background: ${match ? '#d4edda' : '#f8d7da'}">
                                    <td>${adminProduct.name}</td>
                                    <td>${adminProduct.category}</td>
                                    <td>${ecommerceProduct.category}</td>
                                    <td>${match ? '✅ Match' : '❌ Mismatch'}</td>
                                </tr>
                            `;
                        }
                    });
                    
                    html += '</table>';
                    result.innerHTML = html;
                } else {
                    result.innerHTML = '<p class="error">Failed to load products for comparison</p>';
                }
            } catch (error) {
                result.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        }
        
        // Auto-test on page load
        window.onload = function() {
            testMentosCategory();
        };
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products API Testing & Counting</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-button { background: #007AFF; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .test-button:hover { background: #0056CC; }
        .results { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; font-family: monospace; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .count { font-weight: bold; color: #007AFF; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin: 15px 0; }
        .product-card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; }
        .product-image { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; }
        .category-list { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
        .category-tag { background: #e9ecef; padding: 5px 10px; border-radius: 15px; cursor: pointer; }
        .category-tag:hover { background: #007AFF; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Products API Testing & Counting</h1>
        
        <div class="test-section">
            <h2>üìä API Endpoints Testing</h2>
            <button class="test-button" onclick="testAllProducts()">Test All Products</button>
            <button class="test-button" onclick="testCategories()">Test Categories</button>
            <button class="test-button" onclick="testSearch()">Test Search</button>
            <button class="test-button" onclick="testCategoryFilter()">Test Category Filter</button>
            <button class="test-button" onclick="runAllTests()">Run All Tests</button>
            <div id="test-results" class="results"></div>
        </div>

        <div class="test-section">
            <h2>üè∑Ô∏è Categories</h2>
            <div id="categories-container"></div>
            <div id="categories-list" class="category-list"></div>
        </div>

        <div class="test-section">
            <h2>üõçÔ∏è Products</h2>
            <div>
                <input type="text" id="search-input" placeholder="Search products..." style="padding: 8px; margin: 5px; width: 200px;">
                <button class="test-button" onclick="searchProducts()">Search</button>
                <button class="test-button" onclick="clearFilter()">Clear</button>
            </div>
            <div id="products-count" class="count"></div>
            <div id="products-container" class="product-grid"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8191/api';
        
        function log(message, type = 'info') {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            results.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }

        async function apiCall(endpoint, description) {
            try {
                log(`Testing: ${description} - ${endpoint}`);
                const response = await fetch(endpoint);
                const data = await response.json();
                
                if (response.ok && data.status) {
                    log(`‚úÖ ${description} - Success`, 'success');
                    return data;
                } else {
                    log(`‚ùå ${description} - Failed: ${data.message}`, 'error');
                    return null;
                }
            } catch (error) {
                log(`‚ùå ${description} - Error: ${error.message}`, 'error');
                return null;
            }
        }

        async function testAllProducts() {
            const data = await apiCall(`${API_BASE}/products`, 'Get All Products');
            if (data && data.data) {
                log(`üìä Total Products: ${data.data.totalElements}`, 'success');
                displayProducts(data.data.products);
            }
        }

        async function testCategories() {
            const data = await apiCall(`${API_BASE}/categories`, 'Get All Categories');
            if (data && data.data) {
                log(`üìä Total Categories: ${data.data.length}`, 'success');
                displayCategories(data.data);
            }
        }

        async function testSearch() {
            const searchTerm = 'susu';
            const data = await apiCall(`${API_BASE}/products?search=${searchTerm}`, `Search Products (${searchTerm})`);
            if (data && data.data) {
                log(`üìä Search Results: ${data.data.totalElements} products found`, 'success');
                displayProducts(data.data.products);
            }
        }

        async function testCategoryFilter() {
            const category = 'Makanan';
            const data = await apiCall(`${API_BASE}/products?category=${category}`, `Filter by Category (${category})`);
            if (data && data.data) {
                log(`üìä Category Filter Results: ${data.data.totalElements} products in ${category}`, 'success');
                displayProducts(data.data.products);
            }
        }

        async function runAllTests() {
            log('üöÄ Starting comprehensive API tests...', 'success');
            document.getElementById('test-results').innerHTML = '';
            
            await testAllProducts();
            await testCategories();
            await testSearch();
            await testCategoryFilter();
            
            // Test specific endpoints
            await apiCall(`${API_BASE}/products/1`, 'Get Single Product (ID: 1)');
            await apiCall(`${API_BASE}/products/refresh`, 'Refresh Products');
            await apiCall(`${API_BASE}/images/test`, 'Image Test Endpoint');
            
            log('‚úÖ All tests completed!', 'success');
        }

        async function searchProducts() {
            const searchTerm = document.getElementById('search-input').value;
            if (!searchTerm.trim()) {
                alert('Please enter a search term');
                return;
            }
            
            const data = await apiCall(`${API_BASE}/products?search=${searchTerm}`, `Search: ${searchTerm}`);
            if (data && data.data) {
                displayProducts(data.data.products);
                updateProductCount(data.data.totalElements, `Search results for "${searchTerm}"`);
            }
        }

        async function filterByCategory(categoryName) {
            const data = await apiCall(`${API_BASE}/products?category=${categoryName}`, `Filter: ${categoryName}`);
            if (data && data.data) {
                displayProducts(data.data.products);
                updateProductCount(data.data.totalElements, `Products in ${categoryName}`);
            }
        }

        async function clearFilter() {
            document.getElementById('search-input').value = '';
            await testAllProducts();
        }

        function displayProducts(products) {
            const container = document.getElementById('products-container');
            if (!products || products.length === 0) {
                container.innerHTML = '<p>No products found</p>';
                updateProductCount(0);
                return;
            }

            container.innerHTML = products.map(product => `
                <div class="product-card">
                    <img src="${product.image}" alt="${product.name}" class="product-image" 
                         onerror="this.src='https://via.placeholder.com/250x150/f8f9fa/6c757d?text=No+Image'">
                    <h3>${product.name}</h3>
                    <p><strong>Price:</strong> Rp ${product.price?.toLocaleString() || 'N/A'}</p>
                    <p><strong>Category:</strong> ${product.category || 'Uncategorized'}</p>
                    <p><strong>Stock:</strong> ${product.stock || 0}</p>
                    <p><strong>Sold:</strong> ${product.sold || 0}</p>
                </div>
            `).join('');

            updateProductCount(products.length);
        }

        function displayCategories(categories) {
            const container = document.getElementById('categories-list');
            if (!categories || categories.length === 0) {
                container.innerHTML = '<p>No categories found</p>';
                return;
            }

            container.innerHTML = categories.map(category => `
                <div class="category-tag" onclick="filterByCategory('${category.name}')">
                    ${category.icon || 'üì¶'} ${category.name}
                </div>
            `).join('');

            // Also display detailed category info
            const detailContainer = document.getElementById('categories-container');
            detailContainer.innerHTML = `
                <div class="results">
                    <strong>Total Categories: ${categories.length}</strong><br>
                    ${categories.map(cat => `‚Ä¢ ${cat.name} (${cat.icon || 'üì¶'})`).join('<br>')}
                </div>
            `;
        }

        function updateProductCount(count, description = 'Total products') {
            document.getElementById('products-count').innerHTML = `${description}: <span class="count">${count}</span>`;
        }

        // Initialize on page load
        window.onload = function() {
            log('üöÄ Products API Testing Tool Loaded', 'success');
            log('Click "Run All Tests" to start comprehensive testing', 'info');
            
            // Load initial data
            testAllProducts();
            testCategories();
        };
    </script>
</body>
</html>
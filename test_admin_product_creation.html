<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Admin Product Creation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .product { border: 1px solid #eee; padding: 10px; margin: 5px 0; border-radius: 3px; background: #f9f9f9; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
        button { padding: 10px 15px; margin: 5px; background: #007AFF; color: white; border: none; border-radius: 5px; cursor: pointer; }
        input, select, textarea { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Test Admin Product Creation</h1>
    
    <div class="section">
        <h2>Create Test Product</h2>
        <div class="form-group">
            <label>Product Name:</label>
            <input type="text" id="productName" value="Test Product via API" style="width: 300px;">
        </div>
        <div class="form-group">
            <label>Price:</label>
            <input type="number" id="productPrice" value="15000">
        </div>
        <div class="form-group">
            <label>Stock:</label>
            <input type="number" id="productStock" value="50">
        </div>
        <div class="form-group">
            <label>Category:</label>
            <select id="productCategory" style="width: 200px;">
                <option value="">Loading categories...</option>
            </select>
        </div>
        <div class="form-group">
            <label>Description:</label>
            <textarea id="productDescription" style="width: 400px; height: 80px;">Test product created via API to verify admin-ecommerce sync</textarea>
        </div>
        <div class="form-group">
            <label>Image URL:</label>
            <input type="text" id="productImage" value="https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=300" style="width: 400px;">
        </div>
        
        <button onclick="createProduct()">Create Product</button>
        <button onclick="loadCategories()">Reload Categories</button>
    </div>
    
    <div class="section">
        <h2>Creation Result</h2>
        <div id="creation-result">Click "Create Product" to test...</div>
    </div>
    
    <div class="section">
        <h2>Verification</h2>
        <button onclick="verifyInAdmin()">Check in Admin API</button>
        <button onclick="verifyInEcommerce()">Check in Ecommerce API</button>
        <div id="verification-result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8191/api';
        let createdProductId = null;
        
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/admin/categories`);
                const data = await response.json();
                
                const select = document.getElementById('productCategory');
                select.innerHTML = '<option value="">Select Category</option>';
                
                if (data.status && data.data) {
                    data.data.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.name;
                        option.textContent = category.name;
                        select.appendChild(option);
                    });
                } else {
                    select.innerHTML = '<option value="">Failed to load categories</option>';
                }
            } catch (error) {
                console.error('Error loading categories:', error);
                document.getElementById('productCategory').innerHTML = '<option value="">Error loading categories</option>';
            }
        }
        
        async function createProduct() {
            const result = document.getElementById('creation-result');
            result.innerHTML = '<p>Creating product...</p>';
            
            const productData = {
                name: document.getElementById('productName').value,
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                category: document.getElementById('productCategory').value,
                description: document.getElementById('productDescription').value,
                image: document.getElementById('productImage').value,
                rating: 4.5,
                discount: 0,
                sold: 0
            };
            
            if (!productData.name || !productData.price || !productData.category) {
                result.innerHTML = '<p class="error">Please fill in all required fields</p>';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/admin/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                });
                
                const data = await response.json();
                
                if (data.status) {
                    createdProductId = data.data.id;
                    result.innerHTML = `
                        <div class="product">
                            <h3 class="success">✅ Product Created Successfully!</h3>
                            <p><strong>ID:</strong> ${data.data.id}</p>
                            <p><strong>Name:</strong> ${data.data.name}</p>
                            <p><strong>Category:</strong> ${data.data.category || 'N/A'}</p>
                            <p><strong>Price:</strong> Rp ${data.data.price.toLocaleString()}</p>
                            <p><strong>Message:</strong> ${data.message}</p>
                        </div>
                    `;
                } else {
                    result.innerHTML = `<p class="error">❌ Failed to create product: ${data.message}</p>`;
                }
            } catch (error) {
                result.innerHTML = `<p class="error">❌ Error: ${error.message}</p>`;
            }
        }
        
        async function verifyInAdmin() {
            if (!createdProductId) {
                document.getElementById('verification-result').innerHTML = '<p class="warning">Please create a product first</p>';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/admin/products`);
                const data = await response.json();
                
                if (data.status && data.data && data.data.products) {
                    const product = data.data.products.find(p => p.id === createdProductId);
                    
                    if (product) {
                        document.getElementById('verification-result').innerHTML = `
                            <div class="product">
                                <h4 class="success">✅ Found in Admin API</h4>
                                <p><strong>Name:</strong> ${product.name}</p>
                                <p><strong>Category:</strong> ${product.category}</p>
                                <p><strong>Price:</strong> Rp ${product.price.toLocaleString()}</p>
                            </div>
                        `;
                    } else {
                        document.getElementById('verification-result').innerHTML = '<p class="error">❌ Product not found in Admin API</p>';
                    }
                } else {
                    document.getElementById('verification-result').innerHTML = '<p class="error">❌ Failed to load admin products</p>';
                }
            } catch (error) {
                document.getElementById('verification-result').innerHTML = `<p class="error">❌ Admin API Error: ${error.message}</p>`;
            }
        }
        
        async function verifyInEcommerce() {
            if (!createdProductId) {
                document.getElementById('verification-result').innerHTML = '<p class="warning">Please create a product first</p>';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/products`);
                const data = await response.json();
                
                if (data.status && data.data && data.data.products) {
                    const product = data.data.products.find(p => p.id === createdProductId);
                    
                    if (product) {
                        document.getElementById('verification-result').innerHTML = `
                            <div class="product">
                                <h4 class="success">✅ Found in Ecommerce API</h4>
                                <p><strong>Name:</strong> ${product.name}</p>
                                <p><strong>Category:</strong> ${product.category}</p>
                                <p><strong>Price:</strong> Rp ${product.price.toLocaleString()}</p>
                                <p class="success"><strong>✅ Product successfully synced to ecommerce!</strong></p>
                            </div>
                        `;
                    } else {
                        document.getElementById('verification-result').innerHTML = '<p class="error">❌ Product not found in Ecommerce API</p>';
                    }
                } else {
                    document.getElementById('verification-result').innerHTML = '<p class="error">❌ Failed to load ecommerce products</p>';
                }
            } catch (error) {
                document.getElementById('verification-result').innerHTML = `<p class="error">❌ Ecommerce API Error: ${error.message}</p>`;
            }
        }
        
        // Auto-load categories on page load
        window.onload = function() {
            loadCategories();
        };
    </script>
</body>
</html>
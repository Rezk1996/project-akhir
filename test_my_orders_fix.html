<!DOCTYPE html>
<html>
<head>
    <title>Test My Orders Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button { background: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .order-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🛒 My Orders Fix Test</h1>
        
        <div class="section info">
            <h3>🔧 Issue Fixed:</h3>
            <p>OrderService.getOrders() now calls correct endpoint: <code>/orders/user/{userId}</code></p>
            <p>OrdersPage now transforms API response correctly</p>
        </div>
        
        <div class="section">
            <h3>🧪 Test Controls</h3>
            <button onclick="testOrdersAPI()">🔍 Test Orders API</button>
            <button onclick="testUserOrders()">👤 Test User Orders</button>
            <button onclick="clearResults()">🗑️ Clear Results</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8191/api';
        
        async function testOrdersAPI() {
            await addResult('Testing Orders API endpoints...', 'info');
            
            try {
                // Test user 54 (has orders)
                await addResult('Testing user 54 orders...', 'info');
                const response54 = await fetch(`${API_BASE}/orders/user/54`);
                const data54 = await response54.json();
                
                if (data54.status && data54.data.length > 0) {
                    await addResult(`✅ User 54: Found ${data54.data.length} orders`, 'success');
                    await displayOrder(data54.data[0]);
                } else {
                    await addResult('❌ User 54: No orders found', 'error');
                }\n                \n                // Test user 47 (might have orders)\n                await addResult('Testing user 47 orders...', 'info');\n                const response47 = await fetch(`${API_BASE}/orders/user/47`);\n                const data47 = await response47.json();\n                \n                if (data47.status && data47.data.length > 0) {\n                    await addResult(`✅ User 47: Found ${data47.data.length} orders`, 'success');\n                } else {\n                    await addResult('ℹ️ User 47: No orders found', 'info');\n                }\n                \n            } catch (error) {\n                await addResult('❌ API Test failed: ' + error.message, 'error');\n            }\n        }\n        \n        async function testUserOrders() {\n            await addResult('Testing user orders with different user IDs...', 'info');\n            \n            const testUsers = [54, 47, 1, 2, 5]; // Common user IDs\n            \n            for (const userId of testUsers) {\n                try {\n                    const response = await fetch(`${API_BASE}/orders/user/${userId}`);\n                    const data = await response.json();\n                    \n                    if (data.status) {\n                        const orderCount = data.data.length;\n                        if (orderCount > 0) {\n                            await addResult(`✅ User ${userId}: ${orderCount} orders found`, 'success');\n                        } else {\n                            await addResult(`ℹ️ User ${userId}: No orders`, 'info');\n                        }\n                    } else {\n                        await addResult(`❌ User ${userId}: API error - ${data.message}`, 'error');\n                    }\n                } catch (error) {\n                    await addResult(`❌ User ${userId}: Network error - ${error.message}`, 'error');\n                }\n            }\n        }\n        \n        async function displayOrder(order) {\n            const orderHtml = `\n                <div class=\"order-card success\">\n                    <h4>📦 Order #${order.id}</h4>\n                    <p><strong>Status:</strong> ${order.status}</p>\n                    <p><strong>Payment:</strong> ${order.payment_status} (${order.payment_method})</p>\n                    <p><strong>Total:</strong> Rp ${order.total_amount.toLocaleString('id-ID')}</p>\n                    <p><strong>Date:</strong> ${new Date(order.created_at).toLocaleDateString()}</p>\n                    <p><strong>Items:</strong> ${order.items.length} item(s)</p>\n                    <div style=\"margin-top: 10px;\">\n                        <strong>Items:</strong>\n                        <ul>\n                            ${order.items.map(item => \n                                `<li>${item.product_name} x${item.quantity} - Rp ${item.price.toLocaleString('id-ID')}</li>`\n                            ).join('')}\n                        </ul>\n                    </div>\n                </div>\n            `;\n            \n            await addResult(orderHtml, 'success');\n        }\n        \n        async function addResult(content, type = 'info') {\n            const resultsDiv = document.getElementById('results');\n            const section = document.createElement('div');\n            section.className = `section ${type}`;\n            section.innerHTML = content;\n            resultsDiv.appendChild(section);\n            \n            // Scroll to bottom\n            section.scrollIntoView({ behavior: 'smooth' });\n            \n            // Small delay for better UX\n            await new Promise(resolve => setTimeout(resolve, 300));\n        }\n        \n        function clearResults() {\n            document.getElementById('results').innerHTML = '';\n        }\n        \n        // Auto-run test on page load\n        window.onload = function() {\n            setTimeout(testOrdersAPI, 1000);\n        };\n    </script>\n</body>\n</html>